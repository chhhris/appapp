<% @dossiers.each do |dossier| %>
  <tr id="dossier-<%= dossier.id %>">

    <td>
      <%= image_tag ("http://www.gravatar.com/avatar/#{dossier.user.gravatar_id}"),:class => "avatar img-circle hidden-phone"%>
      <span><%= dossier.user.full_name %></span>
    </td>

    <td>
      <%= dossier.aasm_state.humanize %>
    </td>

    <td>
      <div class="btn-group">
        <button class="btn-flat primary icon-flag"><i>Status History </i></button>
        <button class="btn glow dropdown-toggle" data-toggle="dropdown">
          <span class="caret"></span>
        </button>
          <ul class="dropdown-menu">
        <% dossier.dossier_statuses.each do |status| %>
          <li><strong><%= status.status.humanize.downcase %></strong> <%= time_ago_in_words(status.created_at) %> ago</li>
        <% end %>
      </ul>
    </td>

    <td>
      <div class="btn-group">
        <button class="btn-flat inverse icon-thumbs-down"><i class="icon-thumbs-up"></i></button>
        <button class="btn glow dropdown-toggle" data-toggle="dropdown">
          <span class="caret"></span>
        </button>
          <ul class="dropdown-menu">
           
              <% dossier.aasm.events.each do |event| %>
              <% #raise event.inspect%>
            <li><%= link_to event.to_s.humanize, transition_path(dossier, event), method: :put, data: { confirm: 'Are you sure?' } %></li>
          <% end %>
          <% unless ["accepted", "rejected", "wont_attend", "needs_payment"].include? dossier.aasm_state %>
            <li><%= link_to "Reject", transition_path(dossier, :reject), method: :put, data: { confirm: 'Are you sure?' } %></li>
            <li><%= link_to "Accept", transition_path(dossier, :accept), method: :put, data: { confirm: 'Are you sure?' } %></li>
          <% end %>

          </ul>
      </div>

    </td>

  </tr>
<% end %>